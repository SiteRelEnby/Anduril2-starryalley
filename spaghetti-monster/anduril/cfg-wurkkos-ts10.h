// Wurkkos TS10 (originally used Sofirn SP36-t1616 firmware) config options for Anduril using the Attiny1616
// same as  the  BLF Q8, mostly
#include "cfg-blf-q8-t1616.h"
#undef MODEL_NUMBER
#define MODEL_NUMBER "0714"
// ATTINY: 1616

#define PWM_BITS 16
#define USE_DYN_PWM

#undef PWM1_LEVELS
#undef PWM2_LEVELS
#undef MAX_1x7135
#undef HALFSPEED_LEVEL
#undef QUARTERSPEED_LEVEL
#undef THERM_FASTER_LEVEL
#undef RAMP_SMOOTH_FLOOR
#undef RAMP_SMOOTH_CEIL

// level_calc.py 5.01 2 150 7135 1 0.1 150 FET 1 10 1200 --pwm dyn:64:4096:255
#define PWM1_LEVELS 1,1,2,2,3,4,5,6,7,8,9,11,12,14,16,18,20,22,24,27,30,32,35,38,42,45,48,52,56,60,64,68,72,76,80,85,89,94,98,102,107,111,115,119,123,126,130,132,135,137,139,140,141,141,140,138,136,133,128,123,116,108,99,88,75,80,84,89,93,98,104,109,115,121,127,133,140,147,154,161,169,177,185,194,203,212,222,232,242,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0
#define PWM2_LEVELS 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,5,7,9,11,13,15,17,19,21,24,26,29,31,34,37,40,42,45,49,52,55,58,62,65,69,73,77,81,85,89,93,98,103,107,112,117,122,127,133,138,144,149,155,161,168,174,181,187,194,201,208,216,223,231,239,247,255
#define PWM_TOPS 4095,2949,3693,2318,3127,3417,3497,3473,3388,3265,3117,3308,3105,3165,3166,3129,3066,2985,2890,2902,2884,2756,2710,2652,2649,2569,2485,2448,2402,2348,2289,2227,2162,2096,2029,1986,1918,1871,1804,1739,1691,1628,1567,1508,1452,1386,1334,1265,1209,1148,1091,1030,973,913,852,789,732,674,611,553,492,432,374,314,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255

#define MAX_1x7135 90
#define HALFSPEED_LEVEL 15
#define QUARTERSPEED_LEVEL 5
#define DEFAULT_LEVEL 65
#define THERM_FASTER_LEVEL 120
#define MIN_THERM_STEPDOWN 65

#define RAMP_SMOOTH_FLOOR 1
#define RAMP_SMOOTH_CEIL 150

#ifdef USE_INDICATOR_LED_WHILE_RAMPING
#undef USE_INDICATOR_LED_WHILE_RAMPING
#endif

// voltage readings were a little high with the Q8 value
#undef VOLTAGE_FUDGE_FACTOR
#define VOLTAGE_FUDGE_FACTOR 5  // add 0.25V, not 0.35V

// the high button LED mode on this light uses too much power
// off mode: low (1)
// lockout: blinking (3)
#ifdef INDICATOR_LED_DEFAULT_MODE
#undef INDICATOR_LED_DEFAULT_MODE
#define INDICATOR_LED_DEFAULT_MODE ((3<<4) + 1)
#endif

// don't blink during the ramp; the button LED brightness is sufficient
// to indicate which power channel(s) are being used
#ifdef BLINK_AT_RAMP_MIDDLE
#undef BLINK_AT_RAMP_MIDDLE
#endif
#ifdef BLINK_AT_RAMP_CEIL
#undef BLINK_AT_RAMP_CEIL
#endif

// stop panicking at ~60% power or ~3000 lm
#ifdef THERM_FASTER_LEVEL
#undef THERM_FASTER_LEVEL
#endif
#define THERM_FASTER_LEVEL 130

// direct copy from kr4
#define PWM1_LEVELS_STROBE 1,2,3,4,5,6,7,9,10,12,14,16,19,21,24,26,29,33,36,39,43,47,51,56,60,65,70,75,81,86,92,98,105,112,119,126,133,141,149,158,167,176,185,195,205,215,226,237,248,260,272,284,297,310,323,337,352,366,381,397,413,429,446,463,480,498,517,535,555,574,595,615,637,658,680,703,726,750,774,798,823,849,875,902,929,957,985,1014,1043,1073,1104,1135,1166,1199,1232,1265,1299,1334,1369,1405,1441,1478,1516,1554,1593,1633,1673,1714,1756,1798,1841,1885,1929,1974,2020,2066,2113,2161,2209,2258,2308,2359,2410,2463,2515,2569,2623,2679,2735,2791,2849,2907,2966,3026,3086,3148,3210,3273,3337,3402,3467,3533,3601,3669,3738,3807,3878,3949,4022,4095
#define PWM_TOP_CANDLE 0x3FFF // 16383, 14bit PWM, max power is only 25% but it will have smooth transitions
#define PWM_TOP_FIREWORK 0xFFF // 4095, 12bit PWM, max power is 100%

#define USE_LOWPASS_WHILE_ASLEEP